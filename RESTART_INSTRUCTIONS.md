# –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø–æ –ø–æ–ª–Ω–æ–º—É –∑–∞–ø—É—Å–∫—É –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä–∞

## üö® –ö–†–ò–¢–ò–ß–ù–û: –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã!

–í–∞—à –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –∏—Å–ø–æ–ª—å–∑—É–µ—Ç **—Å—Ç–∞—Ä—É—é –≤–µ—Ä—Å–∏—é –∫–æ–¥–∞**. –ú–æ–∏ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –Ω–µ –ø—Ä–∏–º–µ–Ω–∏–ª–∏—Å—å.

### –í–∞—Ä–∏–∞–Ω—Ç 1: –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫ (–†–ï–ö–û–ú–ï–ù–î–£–ï–¢–°–Ø)

```bash
./restart_and_init.sh
```

–≠—Ç–æ—Ç —Å–∫—Ä–∏–ø—Ç:
1. ‚úÖ –û—Å—Ç–∞–Ω–æ–≤–∏—Ç –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã
2. ‚úÖ –ü–µ—Ä–µ—Å–æ–±–µ—Ä–µ—Ç –æ–±—Ä–∞–∑—ã —Å –Ω–æ–≤—ã–º –∫–æ–¥–æ–º
3. ‚úÖ –ó–∞–ø—É—Å—Ç–∏—Ç –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã
4. ‚úÖ –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ—Ç –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö
5. ‚úÖ –ü—Ä–æ–≤–µ—Ä–∏—Ç —Å—Ç–∞—Ç—É—Å

### –í–∞—Ä–∏–∞–Ω—Ç 2: –†—É—á–Ω–æ–π –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫

```bash
# 1. –û—Å—Ç–∞–Ω–æ–≤–∫–∞
docker compose down

# 2. –ü–µ—Ä–µ—Å–±–æ—Ä–∫–∞ (–û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–û! –ò–Ω–∞—á–µ –±—É–¥–µ—Ç —Å—Ç–∞—Ä—ã–π –∫–æ–¥)
docker compose build --no-cache

# 3. –ó–∞–ø—É—Å–∫
docker compose up -d

# 4. –û–∂–∏–¥–∞–Ω–∏–µ –∑–∞–ø—É—Å–∫–∞ –ë–î
sleep 10

# 5. –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ë–î
docker compose exec calculator_api python init_database.py
```

## –ü–æ—Å–ª–µ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞

### 1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—é

–°–∫—Ä–∏–ø—Ç `init_database.py` –¥–æ–ª–∂–µ–Ω –≤—ã–≤–µ—Å—Ç–∏:

```
‚úì –¢–µ—Ö–Ω–æ–ª–æ–≥–∏–∏ —Å—Ç—Ä–æ–∏—Ç–µ–ª—å—Å—Ç–≤–∞: 2 –∑–∞–ø–∏—Å–∏
‚úì –ö–æ–Ω—Ç—É—Ä—ã: 2 –∑–∞–ø–∏—Å–∏
‚úì –¢–∏–ø—ã —ç—Ç–∞–∂–Ω–æ—Å—Ç–∏: 3 –∑–∞–ø–∏—Å–∏
‚úì –ú–∞—Ä–∫–∏ —É—Ç–µ–ø–ª–∏—Ç–µ–ª—è: 3 –∑–∞–ø–∏—Å–∏
‚úì –¢–æ–ª—â–∏–Ω—ã —É—Ç–µ–ø–ª–∏—Ç–µ–ª—è: 3 –∑–∞–ø–∏—Å–∏
‚úì –ë–∞–∑–æ–≤—ã–µ —Ü–µ–Ω—ã: 8 –∑–∞–ø–∏—Å–µ–π
‚úì –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ –≤–∫–ª—é—á–µ–Ω–∏—è: 2 –∑–∞–ø–∏—Å–µ–π
‚úì –î–≤–µ—Ä–∏: 6 –∑–∞–ø–∏—Å–µ–π
...
‚úì –í–°–ï –î–ê–ù–ù–´–ï –ò–ù–ò–¶–ò–ê–õ–ò–ó–ò–†–û–í–ê–ù–´ –ö–û–†–†–ï–ö–¢–ù–û!
```

### 2. –ó–∞–ø—É—Å—Ç–∏—Ç–µ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—é —Å Google Sheets

```bash
curl -X POST http://localhost:8000/admin/sync-prices
```

**–í–ê–ñ–ù–û:** –í –ª–æ–≥–∞—Ö –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ:
```
--- Starting sync for sheet 'std_inclusions' to table 'std_inclusions' (with FK resolution) ---
```

–ï—Å–ª–∏ –≤ –ª–æ–≥–∞—Ö –ù–ï–¢ "(with FK resolution)", –∑–Ω–∞—á–∏—Ç –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –≤—Å–µ –µ—â–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç —Å—Ç–∞—Ä—ã–π –∫–æ–¥!

### 3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏

```bash
docker compose logs -f calculator_api
```

–í—ã –¥–æ–ª–∂–Ω—ã —É–≤–∏–¥–µ—Ç—å:
```
Warning: No tech_code or tech_id provided, using default tech_id=1
Warning: No contour_code or contour_id provided, using default contour_id=1
Warning: No storey_type_code or storey_type_id provided, using default storey_type_id=1
Successfully inserted 3 records into std_inclusions
```

### 4. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ API

```bash
# –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏
curl http://localhost:8000/docs

# –¢–µ—Å—Ç–æ–≤—ã–π —Ä–∞—Å—á–µ—Ç
curl -X POST http://localhost:8000/calculate \
  -H "Content-Type: application/json" \
  -d '{
    "house": {"length_m": 6, "width_m": 6},
    "ceiling": {"type": "flat", "height_m": 2.5},
    "roof": {"overhang_cm": "std"},
    "partitions": {"enabled": false},
    "insulation": {"brand": "izobel", "mm": 100, "build_tech": "panel"},
    "delivery": {"distance_km": 100}
  }'
```

–í –æ—Ç–≤–µ—Ç–µ –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å —Ä–∞–∑–¥–µ–ª `–û–∫–Ω–∞_–∏_–¥–≤–µ—Ä–∏` —Å –¥–≤–µ—Ä—è–º–∏:
```json
{
  "–û–∫–Ω–∞_–∏_–¥–≤–µ—Ä–∏": {
    "–°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ_–æ–∫–Ω–∞": [...],
    "–î–≤–µ—Ä–∏": [
      {
        "–ù–∞–∏–º–µ–Ω–æ–≤–∞–Ω–∏–µ": "–í—Ö–æ–¥–Ω–∞—è –¥–≤–µ—Ä—å –º–µ—Ç–∞–ª–ª–∏—á–µ—Å–∫–∞—è —Å—Ç–∞–Ω–¥–∞—Ä—Ç",
        "–ö–æ–ª–≤–æ": 1,
        "–¶–µ–Ω–∞_—à—Ç_—Ä—É–±": 25000.0,
        "–°—É–º–º–∞_—Ä—É–±": 25000.0
      },
      {
        "–ù–∞–∏–º–µ–Ω–æ–≤–∞–Ω–∏–µ": "–ú–µ–∂–∫–æ–º–Ω–∞—Ç–Ω–∞—è –¥–≤–µ—Ä—å —Å—Ç–∞–Ω–¥–∞—Ä—Ç",
        "–ö–æ–ª–≤–æ": 3,
        "–¶–µ–Ω–∞_—à—Ç_—Ä—É–±": 8000.0,
        "–°—É–º–º–∞_—Ä—É–±": 24000.0
      }
    ]
  }
}
```

## –ß—Ç–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ

### ‚úÖ 1. –û—à–∏–±–∫–∞ tech_id null constraint
- –§—É–Ω–∫—Ü–∏—è `resolve_foreign_keys()` —Ç–µ–ø–µ—Ä—å –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –¥–µ—Ñ–æ–ª—Ç–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è
- –ï—Å–ª–∏ —Å–ø—Ä–∞–≤–æ—á–Ω—ã–µ —Ç–∞–±–ª–∏—Ü—ã –∑–∞–ø–æ–ª–Ω–µ–Ω—ã (—Å–∫—Ä–∏–ø—Ç `init_database.py`), –æ—à–∏–±–∫–∏ –Ω–µ –±—É–¥–µ—Ç

### ‚úÖ 2. –î–≤–µ—Ä–∏ –Ω–∞ —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–µ
- –ë—ç–∫–µ–Ω–¥ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –¥–≤–µ—Ä–∏ –≤ —Ä–∞–∑–¥–µ–ª–µ `–û–∫–Ω–∞_–∏_–¥–≤–µ—Ä–∏.–î–≤–µ—Ä–∏`
- –ï—Å–ª–∏ —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥ –Ω–µ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –∫–Ω–æ–ø–∫–∏ - –Ω—É–∂–Ω–æ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥ –∫–æ–¥
- **–ü—Ä–∏—à–ª–∏—Ç–µ —Ñ–∞–π–ª—ã —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–∞**, —á—Ç–æ–±—ã —è –º–æ–≥ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å

### ‚úÖ 3. –ü–æ–ª–æ–≤–∏–Ω–∞ —Ñ—É–Ω–∫—Ü–∏–π –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç
- –ü–æ—Å–ª–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ –ë–î –≤—Å–µ —Ç–∞–±–ª–∏—Ü—ã –∑–∞–ø–æ–ª–Ω–µ–Ω—ã
- –ü–æ—Å–ª–µ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ —Å Google Sheets –¥–∞–Ω–Ω—ã–µ –æ–±–Ω–æ–≤—è—Ç—Å—è
- –í—Å–µ —Ñ—É–Ω–∫—Ü–∏–∏ –¥–æ–ª–∂–Ω—ã —Ä–∞–±–æ—Ç–∞—Ç—å

## –ü—Ä–æ "–æ–¥–Ω–æ –æ–∫–Ω–æ"

–í –º–æ–µ–π –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –±—ã–ª–æ "—Ö–æ—Ç—è –±—ã –æ–¥–Ω–æ –æ–∫–Ω–æ 100x100" - —ç—Ç–æ **–º–∏–Ω–∏–º—É–º –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è**.

–î–ª—è –ø–æ–ª–Ω–æ–π —Ä–∞–±–æ—Ç—ã –Ω—É–∂–Ω—ã **–≤—Å–µ –æ–∫–Ω–∞**! –ù–æ –≤ –ª–æ–≥–∞—Ö –≤–∏–¥–Ω–æ:
```
Successfully inserted 63 records into window_base_prices
```

–£ –≤–∞—Å —É–∂–µ 63 –æ–∫–Ω–∞! –≠—Ç–æ –æ—Ç–ª–∏—á–Ω–æ! üëç

## –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

1. **–ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã** (–∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ `restart_and_init.sh`)
2. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏** –Ω–∞ –Ω–∞–ª–∏—á–∏–µ "(with FK resolution)"
3. **–ü—Ä–∏—à–ª–∏—Ç–µ –Ω–∞ GitHub:**
   - –ü–ª–∞–Ω —Ä–∞–±–æ—Ç (—Å–ø–∏—Å–æ–∫ –≤—Å–µ—Ö —Ñ—É–Ω–∫—Ü–∏–π, –∫–æ—Ç–æ—Ä—ã–µ –¥–æ–ª–∂–Ω—ã —Ä–∞–±–æ—Ç–∞—Ç—å)
   - –§–∞–π–ª—ã —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–∞ (–≥–¥–µ –∫–Ω–æ–ø–∫–∏ –¥–≤–µ—Ä–µ–π)
   - –°–∫—Ä–∏–Ω—à–æ—Ç—ã –ø—Ä–æ–±–ª–µ–º
   - –ü—Ä–∏–º–µ—Ä—ã –¥–∞–Ω–Ω—ã—Ö –∏–∑ Google Sheets

4. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∫–∞–∂–¥—É—é —Ñ—É–Ω–∫—Ü–∏—é:**
   - –†–∞—Å—á–µ—Ç –±–∞–∑–æ–≤–æ–π —Ü–µ–Ω—ã ‚úì
   - –û–∫–Ω–∞ ‚úì
   - –î–≤–µ—Ä–∏ ‚úì
   - –î–æ–ø—ã ‚úì
   - –î–æ—Å—Ç–∞–≤–∫–∞ ‚úì
   - –ü–µ—Ä–µ–≥–æ—Ä–æ–¥–∫–∏ ‚úì
   - –¢–µ—Ä—Ä–∞—Å—ã/–ö—Ä—ã–ª—å—Ü–∞ ‚úì

–ü–æ—Å–ª–µ —ç—Ç–æ–≥–æ —è —Å–º–æ–≥—É –ø–æ–º–æ—á—å —Å –æ—Å—Ç–∞–≤—à–∏–º–∏—Å—è –ø—Ä–æ–±–ª–µ–º–∞–º–∏!
