# Project Calculator: Движок Ценообразования и Сервис Синхронизации

## Обзор

Этот репозиторий содержит исходный код для комплексного **Движка Ценообразования и Сервиса Синхронизации**, разработанного для строительного или домостроительного бизнеса. Система построена на надежной модели базы данных для управления ценами, материалами и спецификациями строительства, а также предоставляет мощный API для расчета стоимости проекта на основе детальных входных параметров. Он также включает сервис синхронизации для интеграции внешних данных, в частности, с Google Таблицами.

Проект структурирован как полнофункциональное приложение с бэкендом на Python, базой данных PostgreSQL и набором конфигураций Docker для простого развертывания.

## Ключевые особенности

*   **Продвинутый Движок Ценообразования (`src/pricing_engine.py`):** Основной сервис, который рассчитывает окончательную стоимость строительного проекта на основе сложных входных данных, таких как размеры дома, тип потолка, вынос крыши, спецификации утепления и дополнительные опции (терраса, крыльцо, окна, двери).
*   **Модели Базы Данных (`src/models.py`):** Комплексные модели SQLAlchemy, определяющие структуру данных проекта, включая:
    *   `BuildTechnology` (Технология строительства), `InsulationBrand` (Марка утеплителя), `InsulationThickness` (Толщина утеплителя), `StoreyType` (Тип этажности), `Contour` (Контур).
    *   Детальные таблицы цен: `PriceList` (Прайс-лист), `AddonPrice` (Цена доп. опции), `WindowPrice` (Цена окна), `DoorPrice` (Цена двери).
    *   Таблицы конфигурации: `StandardInclusion` (Стандартное включение), `GlobalDefault` (Глобальные настройки по умолчанию).
    *   Таблица `PriceAudit` для отслеживания изменений в ценовых сущностях.
*   **Сервис Синхронизации Данных (`src/sync_service.py`):** Выделенный сервис для синхронизации данных о ценах из внешних источников, с явной поддержкой интеграции с **Google Таблицами**.
*   **Спецификация API (`API_Spec.json`):** Файл JSON, подробно описывающий конечные точки API, вероятно, для интеграции с фронтендом или внешней системой.
*   **Набор Тестов (`tests/`):** Выделенный каталог со стабильным набором тестов для обеспечения точности и надежности логики ценообразования. Включает тесты для движка ценообразования и служебных функций.
*   **Контейнерное Развертывание:** Включает `Dockerfile`, `docker-compose.yml` и `docker-compose.test.yml` для простой настройки и развертывания с использованием Docker.

## Структура Проекта

Репозиторий организован следующим образом:

```
.
├── API_Spec.json               # Спецификация конечных точек API
├── Dockerfile                  # Определение образа Docker для приложения
├── README.md                   # Этот файл
├── docker-compose.yml          # Конфигурация Docker для продакшена/разработки
├── docker-compose.test.yml     # Конфигурация Docker для запуска тестов
├── docs/
│   └── GOOGLE_SHEETS_INTEGRATION.md # Документация по интеграции с Google Таблицами
├── requirements.txt            # Зависимости Python
└── src/
    ├── main.py                 # Основная точка входа в приложение (вероятно, FastAPI/Flask)
    ├── database.py             # Управление подключением к базе данных и сессиями
    ├── models.py               # Модели ORM SQLAlchemy
    ├── pricing_engine.py       # Основная логика расчета стоимости
    ├── schemas.py              # Схемы Pydantic для валидации запросов/ответов API
    └── sync_service.py         # Логика синхронизации данных из внешних источников
└── tests/
    ├── conftest.py             # Фикстуры и конфигурация Pytest
    ├── run_test.py             # Скрипт для выполнения набора тестов
    ├── test_pricing.py         # Тесты для общей логики ценообразования
    └── test_pricing_engine.py  # Специфические тесты для основного движка ценообразования
```

## Настройка и Установка

Проект предназначен для запуска с использованием Docker и Docker Compose.

### Предварительные требования

*   Docker
*   Docker Compose

### Шаги

1.  **Клонируйте репозиторий:**
    ```bash
    git clone https://github.com/aruxojuyu665/project-calculator.git
    cd project-calculator
    ```

2.  **Настройте окружение:**
    Скопируйте пример файла окружения и заполните свои учетные данные для базы данных и сервисов.
    ```bash
    cp .env.example .env
    # Отредактируйте файл .env
    ```

3.  **Соберите и запустите сервисы:**
    Эта команда соберет образ приложения, настроит базу данных и запустит сервисы (API и Сервис Синхронизации).
    ```bash
    docker-compose up --build
    ```

4.  **Запустите тесты (Необязательно):**
    Используйте выделенный файл compose для тестов, чтобы запустить набор тестов.
    ```bash
    docker-compose -f docker-compose.test.yml up --build --abort-on-container-exit
    ```

## Использование API

Основное приложение предоставляет API для расчета проекта. Подробную спецификацию всех конечных точек см. в `API_Spec.json`.

Основная конечная точка, вероятно, представляет собой `POST` запрос к `/calculate`, который принимает `CalculateRequestSchema` (определенную в `src/schemas.py`) и возвращает подробную `CalculateResponseSchema` с разбивкой окончательной стоимости.

## Синхронизация Данных

Система настроена на синхронизацию данных о ценах. Для получения подробной информации о настройке интеграции с Google Таблицами, пожалуйста, обратитесь к специальной документации:

*   [**GOOGLE_SHEETS_INTEGRATION.md**](docs/GOOGLE_SHEETS_INTEGRATION.md)

Этот документ описывает необходимые шаги для аутентификации и сопоставления данных, чтобы гарантировать, что движок ценообразования работает с самыми актуальными данными.
